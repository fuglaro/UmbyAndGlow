# Copyright Â© 2022 John van Leeuwen <jvl@convex.cc>
#    This program is free software: you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation, either version 3 of the License, or
#    (at your option) any later version.
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#    You should have received a copy of the GNU General Public License
#    along with this program.  If not, see <https://www.gnu.org/licenses/>.

## Story data file ##

##
# Script - the story through the dialog of the characters.
# Script data includes the (additive) tape scroll amount for when
# each line of the script occurs and the dialog itself.
# Each entry is usually one line of dialog, but can also include naration
# or other messaging, or even level details. Each line of script
# includes a prefix indicating the character that says the line:
#     "@:" -> Umby says this (overlay at bottom of screen)
#     "^:" -> Glow says this (overlay at top of screen)
#     "" (no prefix) -> Narration (written to middle of background)
# The script can also include level changes which takes the form of a
# tuple with the following form:
#    (feed, spawner)
# E.g:
#    # Level: Cave filled with Bones
#    (
#     # (back, mid-back, mid-back-fill, foreground, foreground-fill)
#     [pattern_toplit_wall,
#      pattern_stalagmites, pattern_stalagmites_fill,
#      pattern_cave, pattern_cave_fill],
#     # Reset monster spawner to the new level
#     (bytearray([Bones]), bytearray([200])))
# Or as a number, which will load the relevant monster directly.

#### MENU ####
-999,([pattern_toplit_wall,pattern_stalagmites,pattern_stalagmites_fill,pattern_cave,pattern_cave_fill],(bytearray([]), bytearray([])))
1,Bones

#================================================
# Chapter 1
# Cave with Bones
1120,"CHAPTER~1: \n The_Cave"

50, ([pattern_toplit_wall,pattern_stalagmites,pattern_stalagmites_fill,pattern_cave,pattern_cave_fill],(bytearray([Bones,Skittle]), bytearray([37,2])))
250, "@: Hi Glow!"
0,   "^: Hi Umby!"
0,   "@: These monsters are destroying our cave!"
0,   "^: Where did they come from?"
0,   "@: I dont know..."
0,   "^: Do you think it was Lung?"
0,   "@: Maybe..."
0,   "@: But this isn't like his usual tricks."

200, "Aim rockets: [UP/DOWN]"

200, "---->"
0,   "^: Hey Umby..."
0,   "@: Yes, Glow?"
0,   "^: They seem to be coming from outside."
0,   "@: Indeed."
0,   "@: Lets head to the entrance."
60,  "---->"
120, "---->"
120, "---->"

200, "Umbys platforms: B*2"
200, "Glows tunnelling: [RIGHT/LEFT]+B [TAPPING:B]"
200, "Shoot each other, not yourself!"

600, "^: What are you thinking, Umby?"
0,   "@: I think something is seriously wrong..."
0,   "@: These monsters..."
0,   "@: I've never seen anything like them before."
0,   "@: They seem really..."
0,   "^: Alien?"
0,   "@: Yes! They have, green blood!"
0,   "^: Well, the cave entrance is just up ahead."
60,  "---->"

# Stop monster spawning
200, ([pattern_toplit_wall,pattern_stalagmites,pattern_stalagmites_fill,pattern_cave,pattern_cave_fill],(bytearray([]), bytearray([])))

200, "^: Ummm... Umby?..."
0,   "@: Yes Glow?..."
0,   "^: What's that rumbling?"
0,   "@: Whatever it is, its big..."
0,   "@: and it's invaded the wrong cave!"
0,   "^: Right. Lets rumble!"

200, "Get ready!"
0,   BonesBoss
0,   "@: Nailed that hit!!"
0,   "^: Sweet!"

# Background changes near tunnel
500, ([pattern_cloudy_snowy_mountains,pattern_stalagmites,pattern_stalagmites_fill,pattern_cave,pattern_cave_fill],(bytearray([]), bytearray([])))

100, "@: Nice work, Glow!"
0,   "^: Back at ya, Umby!"
0,   "@: I think we cleared the whole swarm."
0,   "^: Is that all of them?"
0,   "@: Let's head outside and find out..."

# Snowy mountain background starts, and tunnel
80, ([pattern_cloudy_snowy_mountains,pattern_none,pattern_fill,pattern_tunnel,pattern_fill],(bytearray([]), bytearray([])))

#================================================
# Chapter 2
# Exit tunnel into plains
200, ([pattern_cloudy_snowy_mountains,pattern_ferns,pattern_ferns_fill,pattern_cloudy_plains,pattern_fill],(bytearray([]), bytearray([])))
100, ([pattern_cloudy_snowy_mountains,pattern_ferns,pattern_ferns_fill,pattern_cloudy_plains,pattern_fill],(bytearray([Bones]), bytearray([110])))

130, "@: WOAH!"
0,   "^: SQUIRM!"
0,   "@: They are everywhere!"
0,   "^: What are we going to do?"
0,   "@: Keep blasting and get moving!"
0,   "@: Theres a forest up ahead we can use for cover."
0,   "^: Ok. Ive got your back."
0,   "@: Lets roll..."

70, ([pattern_cloudy_snowy_mountains,pattern_ferns,pattern_ferns_fill,pattern_cloudy_plains,pattern_fill],(bytearray([]), bytearray([])))
150, "CHAPTER~2: \n The_Forest"
50, ([pattern_cloudy_snowy_mountains,pattern_ferns,pattern_ferns_fill,pattern_cloudy_plains,pattern_fill],(bytearray([Bones,Stomper]), bytearray([90,40])))

750, "^: Doing well there, Umby!"
0,   "@: You too, Glow!"
0,   "@: The forest is just up ahead!"
0,   "^: NICE!"

# Enter forest
370, ([pattern_tree_wall,pattern_mid_forest,pattern_mid_forest_fill,pattern_forest,pattern_forest_fill],(bytearray([]), bytearray([])))

360, "^: Phew! We made it!"
0,   "@: That, we did!"
0,   "@: This should provide us with some cover while we think."
0,   "^: Cool. Um... Umby..."
0,   "@: Yes, Glow?"
0,   "^: Did you happen to look up back there?"
0,   "@: I did, and I guess you are referring to..."
0,   "@: The giant alien mothership dominating the sky?"
0,   "^: Yeah. That. So what should we do?"
0,   "@: Let's head in further for safety."
0,   "@: I need to come up with a plan."
0,   "^: Sweet! No need to rush anyway..."
0,   "^: We dont want to be the early worm."
0,   "@: HA! No, we dont."

# Forest monsters
180, ([pattern_tree_wall,pattern_mid_forest,pattern_mid_forest_fill,pattern_forest,pattern_forest_fill],(bytearray([Pillar, Hoot]), bytearray([30, 15])))


800, "@: Alright Glow..."
0,   "@: Here's what I'm thinking..."
0,   "^: I'm all ears, Umby!"
0,   "@: Our cave is not safe,"
0,   "^: Lol, nope!"
0,   "@: And this thing is widespread,"
0,   "^: No kidding!"
0,   "@: And you know I dont like to just wait out a problem!"
0,   "^: You are nothing if not tenatious!"
0,   "@: So let's fix this ourselves."
0,   "^: No way out but through!"
0,   "^: ...just one question..."
0,   "^: How???"
0,   "@: Simple. We head to the mothership."
0,   "^: In space...?"
0,   "@: Yes. We hitch a ride..."
0,   "^: On a monster?"
0,   "@: No, on a Space-Y rocket!"
0,   "^: Space... Y ??"
0,   "@: Why??.. To kill the aliens!"
0,   "^: Okay, but where will we find a Space-Y rocket?"
0,   "@: We live near a Space-Y launchpad!"
0,   "@: Literally like every 3 weeks or so, the whole cave shakes itself half loose, and you always ask -What's that?-, and I always say -The downside of living near a Space-Y launch facility!-"
0,   "@: It's on the other side of the forest."
0,   "^: Ah!... Cool!... Well..."
0,   "^: I'm game!"
0,   "@: Nice! You rock!"
0,   "^: Let's roll."

# Back to the plains (less monsters this time)
400, ([pattern_cloudy_snowy_mountains,pattern_ferns,pattern_ferns_fill,pattern_cloudy_plains,pattern_fill],(bytearray([Bones]), bytearray([10])))

200, "^: Hey!"
0,   "^: Umby, I see it!"
0,   "@: Hey, yeah! There it is."
0,   "^: One shiny rocket."
0,   "@: Looks like the aliens have seen it too..."
0,   "^: What is that? A dragon?"
0,   "@: Its some kind of giant alien worm..."
0,   "^: Well, let's go pick on something definitely not our own size!"
0,   "@: Ha! Right behind you, Glow!"

# Stop monsters spawning
100, ([pattern_cloudy_snowy_mountains,pattern_ferns,pattern_ferns_fill,pattern_cloudy_plains,pattern_fill],(bytearray([]), bytearray([])))

# Boss Battle: Dragon Bones
300, "Get ready!"
100, DragonBones
-999,"^: Nice one, Umby!"
0,   "@: You too, Glow!"
0,   "^: That thing was nuts!"
0,   "@: Indeed. These things are a blight on our home. This monstrous beast is even more reason to dig in and press on."
0,   "^: Let's go eat the frog!"
0,   "@: Eat the frog???"
0,   "^: Yeah!"
0,   "@: Do you mean we should try to do something impossible but by never giving up, eventually succeed?"
0,   "^: Umm... sure!"
0,   "@: I suppose you are right anyway..."
0,   "@: Eventually the worm eats all!!"
0,   "^: Too right! Let's go catch a rocket!"

1600,"CHAPTER~3: \n Space-Y"

100, ([pattern_cloudy_snowy_mountains,pattern_chain_link_fence,pattern_fill,pattern_fence_top,pattern_fill],(bytearray([Pillar,Bones,Stomper]), bytearray([10,10,10])))

300,  "\n \n ____RESTRICTED____ _______AREA_______"
300,  "\n \n ____AUTHORIZED____ __PERSONEL_ONLY!__"
300,  "\n \n ______ACTIVE______ ___LAUNCH__SITE___"

100,  "^: I get the feeling they don't want us here!"
0,    "@: I get the feeling they have enough of their own things to worry about."
0,    "^: No kidding!"

300,  "\n \n _____SPACE__Y...__ _BECAUSE_ITS_COOL!"
300,  "\n \n __SEVERE__DANGER__ _OF_INCINERATION!_"
300,  "\n \n _____SPACE__Y_____ __PERSONEL_ONLY!__"
300,  "\n \n __NO_TRESPASSING__ _SECURE__FACILITY_"

300,  "@: Glow, I see the launch area."
0,    "^: Me too, Umby!"
0,    "@: If we can cross it, we'll just need a way onboard."
0,    "^: Check out all the alien crawlers we need to fight through."
0,    "@: Nice and clear of dragons though."
0,    "^: Yep. Thanks to us!"
0,    "@: Let's worm our way in."
0,    "^: Lol! Go you!"

# Molaar infested launch area
100, ([pattern_cloudy_snowy_mountains,pattern_launch_back,pattern_fill,pattern_launch_area,pattern_launch_area_fill],(bytearray([Bones,Stomper,Molaar]), bytearray([10,5,60])))

900,  "@: Nice spree there, Glow!"
0,    "^: Umby, I'm almost enjoying this!"
0,    "@: It's nice to make the most of it."
0,    "@: It looks like we are about halfway through this swarm."
0,    "^: So we just have more mulch to make!"
0,    "@: Yep, one monster at a time..."

# Launch area (close to rocket, only monsters are stompers)
900, ([pattern_cloudy_snowy_mountains,pattern_launch_back,pattern_fill,pattern_launch_area,pattern_launch_area_fill],(bytearray([Stomper]), bytearray([20])))


200,  "^: Umby, we are major mulch machines!"
0,    "@: No time to dawdle, Glow."
0,    "@: Looks like they're getting ready for something..."
0,    "^: Something like a launch sequence?"
0,    "@: Precisely."
0,    "@: This is the one time we want to be the early worm!"
0,    "^: Last one on's a rotten egg!"
0,    "@: Mmmm... Delicious!"

# Launch pad (with stompers)

# TODO: increase stomper rate to 40

200, ([pattern_cloudy_snowy_mountains,pattern_launch_back,pattern_fill,pattern_launch_pad,pattern_launch_pad_fill],(bytearray([Stomper]), bytearray([0])))

300,  "\n \n ____PREPARING_____ _LAUNCH_SEQEUENCE_"

999, "CHAPTER~X: TEST_(TODO)"

# Create rocket and start countdown (moves +500 into distance automatically)
300, LeftDoor
# TODO:test allowing this battle to continue script.
500,   ([pattern_none,pattern_none,pattern_fill,pattern_door,pattern_fill],(bytearray([]), bytearray([])))
20,  ([pattern_none,pattern_none,pattern_fill,pattern_room,pattern_fill],(bytearray([]), bytearray([])))


# TODO Rocket blast




4400, "Ask fuglaro for more chapters"

################################################################
# Story WIP and Ideas
#
#Umby Space Y
#
#Rocket ship
# LEFT DOOR: manages player and rockets directly. Never draws a sprite, only manipulates tape directly!
#Rocket ship has left and right wall monsters that have specific attacks that just keep the worms in the center (need to detect which monster hits a player).
#Left and right walls shut, keeping the player inside. Cant see outside.
#Background layer monsters can be seen outside, along with clouds and stars. At different rates, they fall down the screen. (Use a bones that explodes on contact with ground - for use elsewhere - maybe another level? Maybe on the return home (because they are falling out of the sky? - fast but doesnt kill worm, just knocks them back and destroys land)
#
#Leading to rocket - boxes piled on ground. Jumping monster?
#
#After launch - rocket destroyed by aliens.
#
#
#----
#Rockets in background
#Countdown to doors closing.  If you don't make it, it's reset. Doors bounce you back off. "Umby was too slow"
#
#Doors shut locking you in and you can see from outside that the rocket is lifting off.
#Monsters get denser, stars start to show. Dialog at **timed intervals**. Needs timer events in dialog queue.
#Death behaviour changes to not scroll back (based on "spaced" variable). Instead, holds worm in middle vertical spot for a while then places on platform on same horizonal position.
#
#Falling monsters and stars are controlled by the right door. That does all the work and timings. This way, everything outside can shake during liftoff.
#
#Monsters start falling down.
#
#^: Woaaaah! Here we go!
#@: Brace yourself, Glow!
#^: I'm hard stuck to this beam. Make sure youre good too, Umby!
#@: Thanks! These G's are only increasing. I'm well planted!
#
#Monsters get faster.
#
#
#
#----
#Level with monster wall that chases you is after the aquarium is destroyed, and a wall of water and monsters rushes after you and you are escaping the exploding ship.
#Lots of stompers to navigate.
#
#----
#Space
#
#Mon: alien with tentacles like an octopus.
#Head is separate sprite to tentacles. Both animate separately, and their position animates relative to each other.
#Similar to Bones but shoots fireballs.
#
#Umby and Glow behave differently:
# - Glow has no gravity but still wall crawls
# - Umby has very low gravity moving downward.
#
#Normal gravity returns when getting on the alien ship.
#
#
#
#
###
### # TODO turn story into script
# TODO: Create bosses for all levels
###
#
# Worm loves worm (referenced and credited)
#Suspect bad worm
#Follow monsters to alien spaceship
#Find Lung held hostage
#Lung gives info as sacrifice (he will be flooded out - no time to save)
#Flood spaceship mainframe
#Go back home
#Cave -> plains -> forest -> plains -> space y -> rocket -> space -> spaceship ->
#    spaceship computer mainframe -> dolphin aquarium ->
#    flooded spaceship -> forest -> cave
###
#
# Take your time, you don't want to be the early worm.
#
#"""
#The dolphins sold our planet? What for?!
#Mock tuna.
#Mock tuna?
#Yeah, synthesized tuna. They even thought they got the better deal. After the fish were wiped out, to the dolphins, the planet was just a big rock. From their point of view, they sold the aliens a rock for tuna.
#Gah! Tricky Blighters!
#


#"""
################################################################

## Credits ##
200, ([pattern_toplit_wall,pattern_none,pattern_fill,pattern_room,pattern_fill],(bytearray([]), bytearray([])))
200, "Credits"
160, "A convex.cc game by John VL"
160, "For my Mum, who taught me how to tinker."
160, "Hardware, Reference, and Dev Platform: ------------------"
160, "TinyCircuits"
160, "Special Thanks To: ------------------"
160, "Lily VL"
160, "Ann VL"
160, "TinyCircuits"
160, "TinyCircuits Thumby Discord Channel"
160, "Auri"
160, "AyreGuitar"
160, "-BBH-"
160, "DarkGizmo"
160, "Doogle"
160, "Laverena"
160, "Mason W."
160, "Nicole D"
160, "Timendus"
160, "TPReal"
160, "transistortester"
160, "Xyvir"
160, "Game Development: ------------------"
160, "John VL"
160, "Graphics: ------------------"
160, "Font by Auri"
160, "John VL"
160, "Lily VL"
160, "Doogle"
160, "Timendus"
160, "Story and Writing: ------------------"
160, "FugLaro"
160, "DarkGizmo"
160, "Audio: ------------------"
160, "Doogle"
160, "HemlockMay"
160, "transistortester"
160, "Play Testers: ------------------"
160, "Andy N"
160, "Ann VL"
160, "Doogle"
160, "John VL"
160, "Lily VL"
160, "Mevlan S"
160, "Paul K"
160, "Vince B"
160, "Thank you for playing!"

# TODO: encore level with randomisation of all previous content

4000000, "GOODBYE!"
100, StopIteration()
